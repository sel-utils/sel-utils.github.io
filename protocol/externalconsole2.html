<!--
 + This file was automatically generated by sel-utils and
 + released under the MIT License.
 + 
 + License: https://github.com/sel-project/sel-utils/blob/master/LICENSE
 + Repository: https://github.com/sel-project/sel-utils
 +-->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>External Console 2</title>
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<meta name="theme-color" content="#1E2327" />
		<link rel="icon" type="image/png" href="/favicon.png" />
		<link rel="canonical" href="https://sel-utils.github.io/protocol/externalconsole2" />
		<link rel="stylesheet" href="/style.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" />
		<script src="https://apis.google.com/js/platform.js" async defer></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
		<script src="https://platform.twitter.com/widgets.js"></script>
		<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-98448660-1', 'auto');ga('send', 'pageview');</script>
	</head>
	<body>
		<div class="nav"><a href="/protocol/">Index</a>  <a href="https://github.com/sel-project/sel-utils/blob/master/README.md">About</a>    <a href="https://github.com/sel-project/sel-utils/blob/master/TYPES.md">Types</a>    <a href="https://github.com/sel-project/sel-utils/blob/master/CONTRIBUTING.md">Contribute</a>    <a href="https://github.com/sel-project/sel-utils/blob/master/xml/protocol/externalconsole2.xml">XML</a>    <a href="https://github.com/sel-project/sel-utils">Github</a></div></div>
		</div>
		<div class="logo" onclick="if(document.body.classList.contains('dark')){document.body.classList.remove('dark');}else{document.body.classList.add('dark');}"></div>
		<h1>External Console 2</h1>
		<a href="https://twitter.com/__selproject" class="twitter-follow-button" data-lang="en" data-show-count="true">Follow @__selproject</a>
		<div style="height:4px"></div>
		<div class="g-plusone" data-size="medium"></div>
		<p>Other protocols: <a href="./externalconsole1">1</a></p>
		<p><strong>Jump to</strong>: <a href="#encoding">Encoding</a>, <a href="#packets">Packets</a>, <a href="types">Types</a></p>
		<p><strong>Released</strong>: February 7th, 2017</p>
		<p>Protocol used to communicate with external sources using a raw TCP protocol or <a href="https://en.wikipedia.org/wiki/WebSocket" target="_blank">Web Sockets</a>.</p>
		<h2>Features</h2>
		<ul>
			<li>Organised remote logs</li>
			<li>Execution of remote commands (if the server allows it)</li>
			<li>Authentication using password hashing (optional)</li>
			<li>Server's resources usage</li>
			<li>Support for the hub-node layout</li>
		</ul>
		<h2>What's new from protocol 1</h2>
		<ul>
			<li>TCP packet are prefixed with their length</li>
			<li>Command can know when they generate output</li>
		</ul>
		<h2>Connecting</h2>
		<h3>Using raw TCP sockets</h3>
		<p>The raw TCP protocol, also referred as "classic", uses a packet-oriented TCP connection, prefixing every packet with its length encoded as a little-endian unsigned 16-bits integer.</p>
		<p>The connection starts with the client sending the string <code>classic</code> encoded as UTF-8 to the server, which replies with an <a href="#login_auth-credentials">AuthCredentials</a> packet and waits for the client to authenticate.</p>
		<h3>Using Web Sockets</h3>
		<p>The websocket protocol uses json packets instead of binary ones (with the keys in snake case) and encodes the arrays of bytes (<a href="#login_auth-credentials_payload">AuthCredentials.payload</a> and <a href="#login_auth_hash">Auth.hash</a>) into strings using base64. The connection is established like every web socket connection and, if successfull, continues with the <a href="#login_auth-credentials">AuthCredentials</a> packet sent by the server.</p>
		<p>Example of a connection in javascript:</p>
		<pre>
			<code class="javascript">var socket = new WebSocket("example.com:19134");
socket.onmessage = function(event){
   var json = JSON.parse(event.data);
   if(json.hash) console.log("The server requires hash " + json.hash_algorithm);
   else console.log("The server doesn't require hashing");
}
</code>
		</pre>
		<h2>Authenticating</h2>
		<p>After receiving the <a href="#login_auth-credentials">AuthCredentials</a> packet, the external console, if able to perform authentication, has to send the password or its hash through the <a href="#login_auth">Auth</a> packet and waits for a response, given by the <a href="#login_welcome">Welcome</a> packet. If the server accepts the external console the status in the packet will be "accepted", the additional fields of the <a href="#login.welcome.accepted" target="_blank">Welcome.Accepted</a> packet can be read and the external console can proceed keeping the connection alive, sending commands, receiving logs and other updates.</p>
		<h2>Keeping the connection alive</h2>
		<p>The server may disconnect the external console after a period of inactivity (which shouldn't be shorter than 8 seconds). For this reason the external console needs to send a <a href="#status_keep-alive">KeepAlive</a> packet to notify the server that it is still perfectly connected.</p>
		<h2>Server's logs</h2>
		<p>Every time a log is created on the server it sends a <a href="#connected_console-message">ConsoleMessage</a> to the external console that contains informations about when the log was generated, from whom was generated and the log itself.</p>
		<h2>Executing commands</h2>
		<p>If the <a href="#login_welcome_accepted_remote-command">remoteCommand</a> field in the <a href="#login_welcome.accepted" target="_blank">Welcome.Accepted</a> packet is true, the server allows the execution of commands from the external console. That's done using the <a href="#connected_command">Command</a> packet, which has only one field that is the raw command.</p>
		<hr>
		<h2 id="encoding">Encoding</h2>
		<p><strong>Endianness</strong>:</p>
		<table>
			<tr>
				<td>big endian</td>
				<td>ushort, int, uint, ulong, float</td>
			</tr>
			<tr>
				<td>little endian</td>
				<td></td>
			</tr>
		</table>
		<p><strong>Ids</strong>: ubyte</p>
		<p><strong>Array's length</strong>: ushort</p>
		<hr>
		<h2 id="packets">Packets</h2>
		<table>
			<tr>
				<th>Section</th>
				<th>Packets</th>
			</tr>
			<tr>
				<td><a href="externalconsole2/login">Login</a></td>
				<td class="center">3</td>
			</tr>
			<tr>
				<td><a href="externalconsole2/status">Status</a></td>
				<td class="center">4</td>
			</tr>
			<tr>
				<td><a href="externalconsole2/connected">Connected</a></td>
				<td class="center">3</td>
			</tr>
		</table>
	</body>
</html>
